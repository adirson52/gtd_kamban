<html lang="pt-BR">
 <head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <title>Kanban de Atividades - Freitas</title>
   <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
   <title>Kanban de Atividades - Freitas (Edição)</title>
   <style>
     body {
       margin: 0;
 @@ -52,6 +52,7 @@
       border-radius: 8px;
       padding: 0.5rem;
       margin-bottom: 0.5rem;
       position: relative;
     }
     .card .title {
       font-weight: 600;
 @@ -74,7 +75,17 @@
       color: #666;
       margin-top: 0.25rem;
     }
     /* Estilo para o aviso temporário */
     .edit-btn {
       position: absolute;
       top: 5px; right: 5px;
       background: #ffc107;
       border: none;
       border-radius: 4px;
       padding: 0.25rem 0.5rem;
       cursor: pointer;
       font-size: 0.8rem;
     }
     /* Aviso temporário */
     #aviso {
       text-align: center;
       padding: 1rem;
 @@ -84,13 +95,36 @@
       margin: 1rem auto;
       max-width: 600px;
       border-radius: 8px;
       display: none;
     }
     /* Modal de edição */
     #editModal {
       display: none; 
       position: fixed; 
       z-index: 1000; 
       top: 50%; left: 50%; 
       transform: translate(-50%, -50%);
       background: white;
       border-radius: 8px;
       padding: 1rem;
       box-shadow: 0 2px 10px rgba(0,0,0,0.3);
       max-width: 400px;
       width: 100%;
     }
     #overlay {
       display: none;
       position: fixed;
       z-index: 999;
       top: 0; left: 0;
       width: 100%; height: 100%;
       background: rgba(0,0,0,0.5);
     }
   </style>
 </head>
 <body>
   <h1>Kanban de Atividades</h1>
   <h1>Kanban de Atividades (Com Edição)</h1>
 
   <!-- Formulário para adicionar nova tarefa -->
   <!-- Formulário para adicionar nova tarefa (igual antes) -->
   <form id="form">
     <input name="titulo" placeholder="Título da tarefa" required />
     <select name="status">
 @@ -105,47 +139,65 @@ <h1>Kanban de Atividades</h1>
     <button type="submit">Adicionar Tarefa</button>
   </form>
 
   <!-- Div para exibir aviso temporário -->
   <div id="aviso" style="display: none;"></div>
   <!-- Aviso temporário -->
   <div id="aviso"></div>
 
   <div class="kanban" id="kanban"></div>
 
   <!-- Modal de edição -->
   <div id="overlay"></div>
   <div id="editModal">
     <h3>Editar Tarefa</h3>
     <form id="editForm">
       <input type="hidden" name="id" />
       <input name="titulo" placeholder="Título da tarefa" required />
       <input name="descricao" placeholder="Descrição (opcional)" />
       <select name="status">
         <option value="urgente">Urgente</option>
         <option value="nao_iniciado">Não Iniciado</option>
         <option value="em_andamento">Em Andamento</option>
         <option value="com_data">Com Data</option>
       </select>
       <input name="tags" placeholder="Tags (ex: faculdade;cws)" />
       <input name="data_limite" placeholder="Data limite (YYYY-MM-DD)" />
       <input name="responsavel" placeholder="Responsável" />
       <button type="submit">Salvar Alterações</button>
       <button type="button" onclick="fecharModal()">Cancelar</button>
     </form>
   </div>
 
   <script>
     // Função para salvar a tarefa no localStorage para exibição imediata
     // ====== CÓDIGO DE CRIAÇÃO DE TAREFA (igual antes) =======
     function salvarTarefaLocal(tarefa) {
       const tarefasCache = JSON.parse(localStorage.getItem("tarefasCache") || "[]");
       tarefasCache.push(tarefa);
       localStorage.setItem("tarefasCache", JSON.stringify(tarefasCache));
     }
 
     // Função para carregar as tarefas do CSV e, se houver conteúdo, limpar o cache local
     async function carregarTarefas() {
       try {
         // Obtém o CSV usando o caminho "public/tasks.csv"
         const response = await fetch("public/tasks.csv");
         if (!response.ok) throw new Error("Não foi possível carregar o arquivo CSV.");
         const text = await response.text();
         const linhas = text.trim().split("\n").slice(1); // ignora o cabeçalho
         const linhas = text.trim().split("\n").slice(1); // ignora cabeçalho
 
         const tarefasCSV = linhas.map((linha) => {
         const tarefasCSV = linhas.map(linha => {
           let campos = linha.match(/(".*?"|[^",]+)(?=,|$)/g) || [];
           campos = campos.map(c => c.replace(/^"|"$/g, '').trim());
           // Garante que sempre existam 7 campos, preenchendo com vazio se necessário
           while (campos.length < 7) {
             campos.push("");
           }
           while (campos.length < 7) campos.push("");
           const [id, titulo, descricao, status, tags, data_limite, responsavel] = campos;
           return { id, titulo, descricao, status, tags, data_limite, responsavel };
         });
 
         // Se o CSV retornar dados, limpamos o cache local para evitar duplicações
         // Se há dados no CSV, limpa cache
         if (tarefasCSV.length > 0) {
           localStorage.removeItem("tarefasCache");
         }
 
         const tarefasCache = JSON.parse(localStorage.getItem("tarefasCache") || "[]");
         const todasTarefas = tarefasCSV.length > 0 ? tarefasCSV : tarefasCache;
 
         // Renderiza no kanban
         const colunas = {
           urgente: "Urgente",
           nao_iniciado: "Não Iniciado",
 @@ -160,29 +212,39 @@ <h1>Kanban de Atividades</h1>
           const col = document.createElement("div");
           col.className = "column";
           col.innerHTML = `<h2>${label}</h2>`;
           todasTarefas.filter(t => t.status === key).forEach(t => {
             const card = document.createElement("div");
             card.className = "card";
             card.innerHTML = `
               <div class="title">${t.titulo}</div>
               <div class="tags">${t.tags.split(";").map(tag => `<span class="tag">${tag}</span>`).join("")}</div>
               ${t.data_limite ? `<div class="date">Prazo: ${t.data_limite}</div>` : ""}
             `;
             col.appendChild(card);
           });
           todasTarefas
             .filter(t => t.status === key)
             .forEach(t => {
               const card = document.createElement("div");
               card.className = "card";
               // Botão Editar
               card.innerHTML = `
                 <div class="title">${t.titulo}</div>
                 <div class="tags">${t.tags.split(";").map(tag => `<span class="tag">${tag}</span>`).join("")}</div>
                 ${t.data_limite ? `<div class="date">Prazo: ${t.data_limite}</div>` : ""}
                 <button class="edit-btn">Editar</button>
               `;
               // Ao clicar em "Editar", abrimos o modal
               card.querySelector(".edit-btn").addEventListener("click", () => {
                 abrirModalEdicao(t);
               });
               col.appendChild(card);
             });
           kanbanDiv.appendChild(col);
         });
       } catch (err) {
         console.error("Erro ao carregar CSV:", err.message);
       }
     }
 
     // Evento de submissão do formulário para adicionar uma nova tarefa
     document.getElementById("form").addEventListener("submit", async (e) => {
       e.preventDefault();
       const form = e.target;
       const novaTarefa = {
         // Para criar uma nova, geramos ID provisório (ex: Date.now()) ou deixamos a API atribuir.
         id: Date.now().toString(),
         titulo: form.titulo.value,
         descricao: "", // não tem no formulário de criação
         status: form.status.value,
         tags: form.tags.value,
         data_limite: form.data_limite.value,
 @@ -197,21 +259,19 @@ <h1>Kanban de Atividades</h1>
         const json = await res.json();
         alert(json.message || json.error);
 
         // Limpa o formulário para evitar duplicação
         // limpa formulário
         form.reset();
 
         // Exibe o aviso temporário
         const avisoDiv = document.getElementById("aviso");
         avisoDiv.style.display = "block";
         avisoDiv.innerText = "Sua tarefa foi enviada, aguarde enquanto a página é atualizada...";
         
         // Salva a tarefa no cache local para exibição imediata
         // Exibe aviso
         exibirAviso("Sua tarefa foi enviada, aguarde atualização...");
 
         // Salva local
         salvarTarefaLocal(novaTarefa);
         
         // Atualiza a interface, exibindo o cache temporário
 
         // Recarrega interface
         carregarTarefas();
         
         // Após 10 segundos, limpa o cache local e recarrega a página para refletir o CSV atualizado
 
         // Após 10s, limpa cache e recarrega
         setTimeout(() => {
           localStorage.removeItem("tarefasCache");
           location.reload();
 @@ -221,7 +281,89 @@ <h1>Kanban de Atividades</h1>
       }
     });
 
     // Carrega as tarefas assim que a página for aberta
     // ====== CÓDIGO DE EDIÇÃO DE TAREFA =======
     // Abre modal, preenche form com dados da tarefa
     function abrirModalEdicao(tarefa) {
       document.getElementById("overlay").style.display = "block";
       const editModal = document.getElementById("editModal");
       editModal.style.display = "block";
       // preenche o form
       const editForm = document.getElementById("editForm");
       editForm.id.value = tarefa.id;
       editForm.titulo.value = tarefa.titulo;
       editForm.descricao.value = tarefa.descricao;
       editForm.status.value = tarefa.status;
       editForm.tags.value = tarefa.tags;
       editForm.data_limite.value = tarefa.data_limite;
       editForm.responsavel.value = tarefa.responsavel;
     }
 
     // Fecha modal
     function fecharModal() {
       document.getElementById("overlay").style.display = "none";
       document.getElementById("editModal").style.display = "none";
     }
 
     // Submissão do form de edição
     document.getElementById("editForm").addEventListener("submit", async (e) => {
       e.preventDefault();
       const editForm = e.target;
       const tarefaEditada = {
         id: editForm.id.value,
         titulo: editForm.titulo.value,
         descricao: editForm.descricao.value,
         status: editForm.status.value,
         tags: editForm.tags.value,
         data_limite: editForm.data_limite.value,
         responsavel: editForm.responsavel.value
       };
       try {
         const res = await fetch("/api/edit-task", {
           method: "POST",
           headers: { "Content-Type": "application/json" },
           body: JSON.stringify(tarefaEditada)
         });
         const json = await res.json();
         alert(json.message || json.error);
 
         fecharModal();
         // Exibe aviso
         exibirAviso("Sua edição foi enviada, aguarde atualização...");
 
         // Salva localmente no cache para exibir de imediato
         salvarEdicaoLocal(tarefaEditada);
 
         // Recarrega a interface
         carregarTarefas();
 
         // Após 10s, limpa cache e recarrega
         setTimeout(() => {
           localStorage.removeItem("tarefasCacheEditar");
           location.reload();
         }, 10000);
       } catch (err) {
         console.error("Erro ao editar tarefa:", err);
       }
     });
 
     // Salva edições localmente (pode ser outro localStorage)
     function salvarEdicaoLocal(tarefaEditada) {
       // ex: "tarefasCacheEditar"
       const cacheEditar = JSON.parse(localStorage.getItem("tarefasCacheEditar") || "[]");
       // Remove caso já exista e substitui
       const filtrado = cacheEditar.filter(t => t.id !== tarefaEditada.id);
       filtrado.push(tarefaEditada);
       localStorage.setItem("tarefasCacheEditar", JSON.stringify(filtrado));
     }
 
     // Exibe aviso na div #aviso
     function exibirAviso(texto) {
       const avisoDiv = document.getElementById("aviso");
       avisoDiv.style.display = "block";
       avisoDiv.innerText = texto;
     }
 
     // Carrega as tarefas ao abrir a página
     carregarTarefas();
   </script>
 </body>
